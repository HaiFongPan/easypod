# EasyPod MVP开发计划

## 项目概述

**项目名称**: EasyPod - 播客播放器
**技术栈**: Electron + React + Node.js
**目标平台**: macOS
**开发周期**: 5.5周 (约240工时)
**团队规模**: 1-2名开发人员

### MVP核心功能
- 播客订阅和播放管理
- FunASR本地音频转写服务
- AI智能总结和章节分段
- Markdown和Obsidian导出
- macOS应用打包和自动更新

---

## 开发阶段分解

### 阶段1: 核心基础设施 (第1-2周)
**目标**: 搭建Electron应用框架和基础播放功能
**工时估算**: 60小时

#### 主要任务
1. **Electron项目初始化** (8小时)
   - 配置electron-builder
   - 设置开发和构建环境
   - 配置TypeScript和ESLint

2. **React UI框架搭建** (16小时)
   - 集成React + TypeScript
   - 配置Tailwind CSS
   - 设置Zustand状态管理
   - 创建基础组件库 (Button, Input, Layout等)

3. **SQLite数据库设计** (12小时)
   - 设计数据库表结构 (feeds, episodes, chapters, transcripts等)
   - 集成better-sqlite3和Drizzle ORM
   - 实现基础CRUD操作
   - 配置FTS5全文搜索

4. **基础音频播放器** (16小时)
   - 实现HTMLAudioElement封装
   - 播放/暂停/快进/后退控制
   - 音量和倍速控制
   - 进度条和时间显示

5. **测试和调试** (8小时)
   - 单元测试配置 (Jest/Vitest)
   - 基础功能集成测试
   - 性能优化

#### 验收标准
- [ ] Electron应用可正常启动并显示React界面
- [ ] SQLite数据库读写功能正常
- [ ] 基础音频播放控制完整且响应流畅
- [ ] UI组件库可复用且样式统一

---

### 阶段2: 订阅和播放功能 (第2-3周)
**目标**: 实现完整的播客订阅、管理和播放体验
**工时估算**: 60小时

#### 主要任务
1. **RSS订阅解析** (16小时)
   - 集成rss-parser库
   - 支持标准RSS和iTunes扩展
   - 解析Podcast 2.0章节信息
   - 错误处理和容错机制

2. **订阅管理界面** (12小时)
   - 订阅列表展示和搜索
   - 添加/删除订阅源
   - OPML导入/导出功能
   - 自动/手动刷新机制

3. **播放控制增强** (16小时)
   - 媒体键支持 (Media Session API)
   - 键盘快捷键绑定
   - 播放队列和历史记录
   - 断点续播功能

4. **章节和Shownote展示** (12小时)
   - 章节列表和时间戳跳转
   - Shownote HTML渲染 (sanitize-html)
   - 时间戳链接解析和跳转
   - 响应式布局适配

5. **集成测试** (4小时)
   - 端到端播放流程测试
   - RSS解析准确性测试
   - 用户交互测试

#### 验收标准
- [ ] 可成功订阅并解析常见播客RSS源
- [ ] 章节跳转和时间戳功能准确 (误差≤1秒)
- [ ] 媒体键和快捷键在前后台均可正常工作
- [ ] 播放进度在应用重启后可正确恢复

---

### 阶段3: FunASR转写集成 (第3-4周)
**目标**: 集成本地音频转写服务和字幕同步功能
**工时估算**: 60小时

#### 主要任务
1. **FunASR服务集成** (24小时)
   - Python环境和依赖管理
   - FunASR模型下载和配置
   - HTTP/gRPC服务接口设计
   - 任务队列和进度跟踪

2. **音频预处理** (12小时)
   - FFmpeg集成和音频格式转换
   - 音频分段和采样率统一
   - 元数据提取和处理

3. **字幕同步和显示** (16小时)
   - 实时字幕滚动组件
   - 时间戳对齐和校正
   - SRT/VTT格式导出
   - 字幕点击跳转功能

4. **性能优化和测试** (8小时)
   - 转写任务并发处理
   - 内存和CPU使用优化
   - 长音频文件处理测试

#### 验收标准
- [ ] 60分钟音频转写时间≤40分钟 (M1/M2 Mac)
- [ ] 字幕与音频同步误差≤500ms
- [ ] 转写过程中UI保持响应，可取消任务
- [ ] 生成的字幕文件格式符合SRT/VTT标准

---

### 阶段4: AI功能集成 (第4-5周)
**目标**: 实现AI智能总结和内容分析功能
**工时估算**: 40小时

#### 主要任务
1. **AI Provider抽象层** (16小时)
   - 统一AI服务接口设计
   - 支持OpenAI API兼容格式
   - 配置管理和凭证存储 (macOS Keychain)
   - 重试机制和错误处理

2. **总结和分章节功能** (16小时)
   - Prompt模板系统设计
   - 播客总结生成 (要点/金句/行动项)
   - 智能章节分段算法
   - AI任务历史记录

3. **Markdown导出** (8小时)
   - 模板化Markdown生成
   - 元数据和内容格式化
   - 文件路径管理和命名规则

#### 验收标准
- [ ] 可配置并成功调用至少1个AI Provider
- [ ] 生成的总结内容结构化且可读性好
- [ ] 智能分章节准确率≥80% (人工抽样验证)
- [ ] Markdown导出格式符合标准且包含完整信息

---

### 阶段5: Obsidian导出和应用打包 (第5-6周)
**目标**: 完成最终集成和发布准备
**工时估算**: 20小时

#### 主要任务
1. **Obsidian本地导出** (12小时)
   - 检测Obsidian vault目录
   - YAML Front Matter生成
   - 双链和标签支持
   - 文件冲突处理和更新逻辑

2. **应用打包和分发** (8小时)
   - electron-builder配置优化
   - macOS代码签名和公证
   - DMG安装包制作
   - 自动更新机制 (electron-updater)

#### 验收标准
- [ ] 可成功导出内容到指定Obsidian库
- [ ] 生成的DMG可在macOS上正常安装和运行
- [ ] 自动更新功能可检测和下载更新
- [ ] 应用符合macOS安全和分发要求

---

## 技术实现细节

### 核心技术栈
- **前端**: React 18 + TypeScript + Tailwind CSS
- **状态管理**: Zustand
- **桌面框架**: Electron
- **数据库**: SQLite + better-sqlite3 + Drizzle ORM
- **音频处理**: FFmpeg + HTMLAudioElement
- **转写服务**: FunASR (Python)
- **构建工具**: Vite + electron-builder

### 系统架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Main Process  │    │ Renderer Process │    │ Worker Process  │
│                 │    │                 │    │                 │
│ • 系统集成      │◄──►│ • React UI      │    │ • 音频下载      │
│ • 菜单托盘      │    │ • 用户交互      │    │ • FunASR调用    │
│ • IPC协调       │    │ • 状态管理      │    │ • AI任务处理    │
│ • 协议处理      │    │ • 媒体播放      │    │ • 文件导出      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 数据存储设计
```sql
-- 核心数据表
feeds (id, title, url, cover_url, last_checked_at, meta_json)
episodes (id, feed_id, guid, title, audio_url, duration_sec, status, last_position_sec)
transcripts (id, episode_id, engine, srt_path, status, created_at)
ai_tasks (id, episode_id, provider, prompt_template_id, output_md, status)

-- 全文搜索索引
CREATE VIRTUAL TABLE search_index USING fts5(title, description, transcript_text);
```

---

## 项目依赖关系

### 关键依赖路径
1. **Electron框架** → **React UI** → **功能模块**
2. **SQLite数据库** → **数据模型** → **业务逻辑**
3. **音频播放** → **转写功能** → **AI分析**
4. **AI功能** → **导出模块** → **集成测试**

### 外部依赖风险
- FunASR Python环境配置复杂度
- AI API服务稳定性和成本控制
- macOS签名证书和公证流程
- 第三方库版本兼容性

---

## 风险分析与缓解策略

### 高风险项目
**1. FunASR集成复杂性**
- **风险**: Python环境配置、模型文件体积、转写性能
- **缓解**: 提前验证FunASR接口，准备云端API备选方案，预留20%额外时间
- **监控**: 每日转写功能测试，性能基准跟踪

**2. 转写性能和准确性**
- **风险**: 长音频处理时间过长、字幕同步误差大
- **缓解**: 实现音频分段并行处理，时间戳校正算法优化
- **监控**: 建立性能测试基准，准确性抽样验证

### 中等风险项目
**3. AI API成本和限速**
- **风险**: 调用频率限制、成本超预算
- **缓解**: 实现调用队列和重试机制，支持多Provider切换
- **监控**: 成本追踪仪表板，API调用成功率监控

**4. 应用打包和签名**
- **风险**: macOS公证失败、自动更新配置错误
- **缓解**: 提前申请开发者证书，建立CI/CD自动化流程
- **监控**: 构建成功率跟踪，发布流程检查清单

---

## 测试策略

### 测试层级
1. **单元测试** (Jest/Vitest)
   - 数据库操作和数据模型
   - RSS解析和内容提取
   - 导出格式生成
   - 时间戳计算和转换

2. **集成测试**
   - FunASR端到端转写流程
   - AI Provider调用和响应处理
   - 文件导入导出完整性
   - 音频播放和控制同步

3. **端到端测试** (Playwright/Spectron)
   - 完整用户工作流
   - 跨功能模块交互
   - 性能和稳定性测试

4. **手动测试清单**
   - [ ] 媒体键和快捷键响应
   - [ ] 离线模式功能完整性
   - [ ] 长时间运行稳定性
   - [ ] 各种播客源兼容性
   - [ ] UI响应性和用户体验

### 性能基准
- 应用冷启动时间: ≤2.5秒
- 60分钟音频转写: ≤40分钟 (M1 Mac)
- 字幕同步误差: ≤500ms
- UI操作响应时间: ≤100ms
- 内存使用峰值: ≤1GB

---

## 里程碑和验收标准

### 里程碑1: 基础框架完成 (第2周)
**验收标准**:
- [x] Electron应用正常启动和基础UI显示
- [x] SQLite数据库CRUD操作功能完整
- [x] 音频播放基础控制 (播放/暂停/进度)
- [x] 开发环境和构建流程稳定

### 里程碑2: 核心播放功能 (第3周)
**验收标准**:
- [x] RSS订阅解析成功率≥95%
- [x] 章节跳转和时间戳功能准确
- [x] 媒体键集成和快捷键响应
- [x] 播放历史和断点续播正常

### 里程碑3: 转写功能集成 (第4周)
**验收标准**:
- [x] FunASR服务启动和音频转写成功
- [x] 字幕滚动和时间同步误差≤500ms
- [x] 支持SRT/VTT格式导出
- [x] 转写任务并发处理和进度显示

### 里程碑4: AI功能完整 (第5周)
**验收标准**:
- [x] AI Provider配置和调用正常
- [x] 播客总结内容结构化和可读性好
- [x] 智能分章节准确率≥80%
- [x] Markdown导出格式符合标准

### 里程碑5: MVP发布就绪 (第6周)
**验收标准**:
- [x] Obsidian导出功能完整
- [x] DMG安装包制作和代码签名
- [x] 自动更新机制配置完成
- [x] 完整端到端用户流程测试通过
- [x] 性能指标达到预期基准

---

## 资源需求

### 人力资源
- **主开发人员**: 1名 (全栈开发)
- **协作支持**: 1名 (UI/测试, 兼职)
- **技术顾问**: 按需咨询 (AI/音频处理专家)

### 硬件和服务
- **开发设备**: MacBook Pro M1/M2 (16GB内存推荐)
- **测试设备**: 多款macOS版本设备
- **云服务**: AI API调用额度 ($50-100预算)
- **开发者账号**: Apple Developer Program ($99/年)

### 第三方依赖
- **必需**: Electron, React, SQLite, FunASR
- **可选**: 商业AI服务 (OpenAI, Claude等)
- **工具**: VS Code, Git, Docker (用于环境隔离)

---

## 项目交付物

### 代码和文档
1. **源代码仓库** (Git)
   - 完整的Electron应用代码
   - 构建和部署脚本
   - API文档和技术说明

2. **用户文档**
   - 安装和使用指南
   - 功能特性说明
   - 故障排除指南

3. **开发者文档**
   - 架构设计文档
   - API接口规范
   - 扩展开发指南

### 发布包
1. **macOS应用** (.dmg格式)
2. **自动更新配置** (更新服务器)
3. **测试报告** (功能和性能)

---

## 后续发展路线

### v1.1 增强版 (MVP后4-6周)
- 说话人分离和标注
- 当前集Chat对话功能
- Notion云端导出
- PDF格式导出
- UI/UX优化和主题切换

### v1.2 专业版 (v1.1后6-8周)
- 历史内容检索和Chat
- XMind/OPML思维导图导出
- 多AI Provider支持和切换
- 播客内容标注和高亮
- 社区功能和订阅推荐

### v1.3 企业版 (v1.2后8-10周)
- 批量转写和分析工具
- 团队协作和分享功能
- API开放和插件系统
- 高级分析和统计报表
- 多语言支持

---

## 成功指标

### 技术指标
- [ ] 所有核心功能按时完成且质量达标
- [ ] 性能基准100%达成
- [ ] 测试覆盖率≥80%
- [ ] 关键bug数≤5个

### 产品指标
- [ ] 完整用户工作流顺畅无阻
- [ ] AI生成内容质量可直接使用
- [ ] 导出格式兼容性100%
- [ ] 用户反馈积极度≥85%

### 项目管理指标
- [ ] 开发周期控制在6周内
- [ ] 预算使用不超过110%
- [ ] 里程碑按时完成率≥90%
- [ ] 团队成员满意度≥4/5

---

*最后更新: 2024-09-24*
*文档版本: 1.0*